---
import ActionButton from '@components/ActionButton.astro'
import '../styles/global.css'
import constants from '@i18n/constants'

const { lang, t } = Astro.props
const copyRightText = `Â© ${new Date().getFullYear()} ${constants.title}`
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={t.meta.description} />
    <meta name="generator" content={Astro.generator} />

    <!-- Open Graph / Social Media -->
    <meta property="og:title" content={constants.title} />
    <meta property="og:description" content={t.meta.description} />
    <meta property="og:type" content="website" />

    <title>{constants.title}</title>

    <!-- Theme script (runs before page render to prevent flash) -->
    <script is:inline>
      (function() {
        const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
        if (darkModeQuery.matches) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>

  <body class="min-h-screen bg-linear-to-b from-gray-50 to-gray-100 dark:from-[#0a0520] dark:via-[#1a0a3e] dark:to-[#2a0e4a] transition-colors duration-300">
    <slot />

    <footer class="relative mt-12 pb-8 px-4">
      <div class="flex flex-col md:flex-row items-center justify-center md:relative gap-4">
        <p class="text-sm text-gray-600 dark:text-gray-500">
          {copyRightText}
        </p>

        <!-- 3D Language Toggle Switch -->
        <div class="flex items-center gap-3 md:absolute md:right-12">
          <span class="text-xs text-gray-600 dark:text-gray-400" id="language-label">
            {t.languageSelector}
          </span>

          <button
            aria-label={t.languageSelector}
            data-lang={lang}
            id="language-toggle"
            class="relative w-16 h-8 rounded-full transition-all duration-300 focus:outline-none group bg-linear-to-b from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-800 overflow-hidden"
            style="box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2), 0 1px 2px rgba(0, 0, 0, 0.1);"
          >
            <!-- Toggle Track Inner Glow -->
            <div
              id="track-glow"
              class="absolute inset-0 rounded-full opacity-50 transition-opacity duration-300"
            ></div>

            <!-- Toggle Ball -->
            <div
              id="toggle-ball"
              class="absolute top-0.5 w-7 h-7 left-2 transition-all duration-300 ease-in-out"
            >
              <div
                id="ball-inner"
                class="w-full h-full rounded-full transition-all duration-300"
              ></div>
            </div>
          </button>
        </div>
      </div>
    </footer>

    <script>
      import '../scripts/theme';
    </script>
  </body>

  <script>
    const languageToggle = document.getElementById('language-toggle');
    const toggleBall = document.getElementById('toggle-ball');
    const ballInner = document.getElementById('ball-inner');
    const trackGlow = document.getElementById('track-glow');
    const languageLabel = document.getElementById('language-label');

    if (languageToggle && toggleBall && ballInner && trackGlow) {
      const currentLang = languageToggle.getAttribute('data-lang') || 'en';
      const isDark = document.documentElement.classList.contains('dark');

      // Apply initial styles based on language
      const applyLanguageStyles = (lang: string) => {
        const isEnglish = lang === 'en';

        // Update toggle button background
        if (isDark) {
          languageToggle.style.background = 'linear-gradient(180deg, #374151 0%, #1f2937 100%)';
          languageToggle.style.boxShadow = 'inset 0 2px 4px rgba(0, 0, 0, 0.6), 0 1px 2px rgba(0, 0, 0, 0.3)';
        } else {
          languageToggle.style.background = 'linear-gradient(180deg, #e5e7eb 0%, #d1d5db 100%)';
          languageToggle.style.boxShadow = 'inset 0 2px 4px rgba(0, 0, 0, 0.2), 0 1px 2px rgba(0, 0, 0, 0.1)';
        }

        // Update track glow
        trackGlow.style.background = isEnglish
          ? 'linear-gradient(90deg, transparent 0%, rgba(34, 211, 238, 0.3) 100%)'
          : 'linear-gradient(90deg, rgba(236, 72, 153, 0.3) 0%, transparent 100%)';

        // Update ball position
        toggleBall.style.left = isEnglish ? '2px' : 'calc(100% - 30px)';

        // Update ball appearance
        if (isEnglish) {
          ballInner.style.background = isDark
            ? 'linear-gradient(145deg, #22d3ee, #06b6d4)'
            : 'linear-gradient(145deg, #67e8f9, #22d3ee)';
          ballInner.style.boxShadow = isDark
            ? '0 2px 8px rgba(34, 211, 238, 0.6), inset 0 1px 2px rgba(255, 255, 255, 0.3), inset 0 -2px 4px rgba(0, 0, 0, 0.2)'
            : '0 2px 8px rgba(34, 211, 238, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.5), inset 0 -2px 4px rgba(0, 0, 0, 0.1)';
        } else {
          ballInner.style.background = isDark
            ? 'linear-gradient(145deg, #ec4899, #db2777)'
            : 'linear-gradient(145deg, #f9a8d4, #ec4899)';
          ballInner.style.boxShadow = isDark
            ? '0 2px 8px rgba(236, 72, 153, 0.6), inset 0 1px 2px rgba(255, 255, 255, 0.3), inset 0 -2px 4px rgba(0, 0, 0, 0.2)'
            : '0 2px 8px rgba(236, 72, 153, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.5), inset 0 -2px 4px rgba(0, 0, 0, 0.1)';
        }
      };

      // Apply initial styles
      applyLanguageStyles(currentLang);

      // Handle click
      languageToggle.addEventListener('click', () => {
        const newLang = currentLang === 'en' ? 'es' : 'en';
        window.location.href = window.location.href.replace(/\/(en|es)(\/|$)/, `/${newLang}$2`);
      });
    }
  </script>
</html>
