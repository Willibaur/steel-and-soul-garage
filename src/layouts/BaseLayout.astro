---
import ActionButton from '@components/ActionButton.astro'
import '../styles/global.css'
import constants from '@i18n/constants'

const { lang, t } = Astro.props
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={t.meta.description} />
    <meta name="generator" content={Astro.generator} />

    <!-- Open Graph / Social Media -->
    <meta property="og:title" content={constants.title} />
    <meta property="og:description" content={t.meta.description} />
    <meta property="og:type" content="website" />

    <title>{constants.title}</title>

    <!-- Theme script (runs before page render to prevent flash) -->
    <script is:inline>
      (function() {
        const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');
        if (darkModeQuery.matches) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>

  <body class="min-h-screen bg-linear-to-b from-gray-50 to-gray-100 dark:from-[#0a0520] dark:via-[#1a0a3e] dark:to-[#2a0e4a] transition-colors duration-300">
    <slot />

    <!-- <script>
      const languageSelected = document.getElementById('language-selected') as HTMLSelectElement | null

      languageSelected?.addEventListener('change', ({ target }) => {
        const selectedLang = (target as HTMLSelectElement).value
        const newPath = window.location.pathname.replace(/^\/(en|es)/, `/${selectedLang}`)
        window.location.pathname = newPath
      })
    </script> -->

    <script>
      import '../scripts/theme';
    </script>
  </body>

  <footer>
    <ActionButton
      variant="language"
      id="language-toggle"
      data-lang={lang}
    >
      <span class="text-lg">{t.languageButton}</span>
    </ActionButton>

    <div class="mt-12 text-center">
      <p class="text-sm text-gray-600 dark:text-gray-500">
        ¬© 2025 Steel & Soul Garage
      </p>
    </div>
  </footer>

  <script>
    const languageToggle = document.getElementById('language-toggle');
    if (languageToggle) {
      languageToggle.addEventListener('click', () => {
        const currentLang = languageToggle.getAttribute('data-lang');
        console.log('üíª üêõ - currentLang:', currentLang)
        const newLang = currentLang === 'en' ? 'es' : 'en';
        const newPath = window.location.pathname.replace(/^\/(en|es)/, `/${newLang}`);
        window.location.pathname = newPath;
      });
    }
  </script>
</html>
